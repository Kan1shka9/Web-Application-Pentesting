#### 1. Hypertext Transfer Protocol

###### Basics of HTTP and HTTP 1.0 vs HTTP 1.1
- Client-Server based architecture- Request-Response model to serve Resources- Resources are identified by URI / URL- Versions â€“ HTTP 1.0/1.1	- 1.1 can reuse connections for multiple URIs

```sh
root@kali:~# curl -v commercefun.com
* Rebuilt URL to: commercefun.com/
*   Trying 192.185.165.194...
* TCP_NODELAY set
* Connected to commercefun.com (192.185.165.194) port 80 (#0)
> GET / HTTP/1.1
> Host: commercefun.com
> User-Agent: curl/7.52.1
> Accept: */*
>
< HTTP/1.1 200 OK
< Server: nginx/1.12.1
< Date: Fri, 15 Sep 2017 17:56:46 GMT
< Content-Type: text/html
< Content-Length: 88
< Connection: keep-alive
< Last-Modified: Fri, 15 Sep 2017 17:49:12 GMT
< Accept-Ranges: bytes
<
<!DOCTYPE html>
<html>
<body>

<p>Sample Page - Owned by kan1shka9</p>

</body>
</html>
* Curl_http_done: called premature == 0
* Connection #0 to host commercefun.com left intact
root@kali:~#
```

```sh
root@kali:~# curl commercefun.com
<!DOCTYPE html>
<html>
<body>

<p>Sample Page - Owned by kan1shka9</p>

</body>
</html>
root@kali:~#
```

```sh
root@kali:~# nc commercefun.com 80
GET / HTTP/1.0
Host:www.commercefun.com

HTTP/1.1 200 OK
Server: nginx/1.12.1
Date: Fri, 15 Sep 2017 18:03:45 GMT
Content-Type: text/html
Content-Length: 88
Connection: close
Last-Modified: Fri, 15 Sep 2017 17:49:12 GMT
Accept-Ranges: bytes

<!DOCTYPE html>
<html>
<body>

<p>Sample Page - Owned by kan1shka9</p>

</body>
</html>
root@kali:~#
```

```sh
root@kali:~# nc commercefun.com 80
GET / HTTP/1.1
Host:www.commercefun.com

HTTP/1.1 200 OK
Server: nginx/1.12.1
Date: Fri, 15 Sep 2017 18:06:16 GMT
Content-Type: text/html
Content-Length: 88
Connection: keep-alive
Last-Modified: Fri, 15 Sep 2017 17:49:12 GMT
Accept-Ranges: bytes

<!DOCTYPE html>
<html>
<body>

<p>Sample Page - Owned by kan1shka9</p>

</body>
</html>

GET /out.txt HTTP/1.1
Host:commercefun.com

HTTP/1.1 200 OK
Server: nginx/1.12.1
Date: Fri, 15 Sep 2017 18:06:41 GMT
Content-Type: text/plain
Content-Length: 18
Connection: keep-alive
Last-Modified: Fri, 15 Sep 2017 18:05:45 GMT
Accept-Ranges: bytes

Text File for Demo

GET / HTTP/1.1
Host:www.commercefun.com
Connection:close

HTTP/1.1 200 OK
Server: nginx/1.12.1
Date: Fri, 15 Sep 2017 18:07:22 GMT
Content-Type: text/html
Content-Length: 88
Connection: close
Last-Modified: Fri, 15 Sep 2017 17:49:12 GMT
Accept-Ranges: bytes

<!DOCTYPE html>
<html>
<body>

<p>Sample Page - Owned by kan1shka9</p>

</body>
</html>
root@kali:~#
```

```
http.request.method == "GET"
```

![Image of wireshark](images/1.jpeg)

###### HTTP Methods and Verb Tampering

- HTTP Request Methods
	- GET		- Parameters in URL	- POST		- Form submissions, data in message body	- OPTIONS		- List of methods supported for URL	- HEAD		- Response for GET but no message body	- TRACE		- Echo client request back for diagnostics	- PUT		- Store in URI	- DELETE		- Delete resource

```sh
root@kali:~# curl -v -X GET http://www.commercefun.com
Note: Unnecessary use of -X or --request, GET is already inferred.
* Rebuilt URL to: http://www.commercefun.com/
*   Trying 192.185.165.194...
* TCP_NODELAY set
* Connected to www.commercefun.com (192.185.165.194) port 80 (#0)
> GET / HTTP/1.1
> Host: www.commercefun.com
> User-Agent: curl/7.52.1
> Accept: */*
>
< HTTP/1.1 200 OK
< Server: nginx/1.12.1
< Date: Fri, 15 Sep 2017 18:27:25 GMT
< Content-Type: text/html
< Content-Length: 88
< Connection: keep-alive
< Last-Modified: Fri, 15 Sep 2017 17:49:12 GMT
< Accept-Ranges: bytes
<
<!DOCTYPE html>
<html>
<body>

<p>Sample Page - Owned by kan1shka9</p>

</body>
</html>
* Curl_http_done: called premature == 0
* Connection #0 to host www.commercefun.com left intact
root@kali:~#
```

```sh
root@kali:~# curl -v -X HEAD http://www.commercefun.com
Warning: Setting custom HTTP method to HEAD with -X/--request may not work the
Warning: way you want. Consider using -I/--head instead.
* Rebuilt URL to: http://www.commercefun.com/
*   Trying 192.185.165.194...
* TCP_NODELAY set
* Connected to www.commercefun.com (192.185.165.194) port 80 (#0)
> HEAD / HTTP/1.1
> Host: www.commercefun.com
> User-Agent: curl/7.52.1
> Accept: */*
>
< HTTP/1.1 200 OK
< Server: nginx/1.12.1
< Date: Fri, 15 Sep 2017 18:27:32 GMT
< Content-Type: text/html
< Content-Length: 88
< Connection: keep-alive
< Last-Modified: Fri, 15 Sep 2017 17:49:12 GMT
< Accept-Ranges: bytes
<
^C
root@kali:~#
```

```sh
root@kali:~# curl -v -X OPTIONS http://www.commercefun.com
* Rebuilt URL to: http://www.commercefun.com/
*   Trying 192.185.165.194...
* TCP_NODELAY set
* Connected to www.commercefun.com (192.185.165.194) port 80 (#0)
> OPTIONS / HTTP/1.1
> Host: www.commercefun.com
> User-Agent: curl/7.52.1
> Accept: */*
>
< HTTP/1.1 200 OK
< Server: nginx/1.12.1
< Date: Fri, 15 Sep 2017 18:25:50 GMT
< Content-Type: text/html
< Content-Length: 0
< Connection: keep-alive
< Allow: OPTIONS,GET,HEAD,POST
<
* Curl_http_done: called premature == 0
* Connection #0 to host www.commercefun.com left intact
root@kali:~#
```

```sh
root@kali:~# curl -v -X TRACE http://www.commercefun.com
* Rebuilt URL to: http://www.commercefun.com/
*   Trying 192.185.165.194...
* TCP_NODELAY set
* Connected to www.commercefun.com (192.185.165.194) port 80 (#0)
> TRACE / HTTP/1.1
> Host: www.commercefun.com
> User-Agent: curl/7.52.1
> Accept: */*
>
< HTTP/1.1 405 Not Allowed
< Server: nginx/1.12.1
< Date: Fri, 15 Sep 2017 18:29:10 GMT
< Content-Type: text/html
< Content-Length: 173
< Connection: close
<
<html>
<head><title>405 Not Allowed</title></head>
<body bgcolor="white">
<center><h1>405 Not Allowed</h1></center>
<hr><center>nginx/1.12.1</center>
</body>
</html>
* Curl_http_done: called premature == 0
* Closing connection 0
root@kali:~#
```

- HEAD - Security Risks

	- [JBoss JMX-Console Authentication Bypass](https://www.optiv.com/blog/jboss-jmx-console-authentication-bypass)
	- [What you need to know about HTTP Verb Tampering](http://blog.jeremiahgrossman.com/2008/06/what-you-need-to-know-about-http-verb.html)

- Exercise	- Find appropriate Nmap NSE scripts which test for HTTP Verb tampering

	```sh
	root@kali:~# nmap --script http-methods commercefun.com
	
	Starting Nmap 7.40 ( https://nmap.org ) at 2017-09-15 14:57 EDT
	Nmap scan report for commercefun.com (192.185.165.194)
	Host is up (0.096s latency).
	rDNS record for 192.185.165.194: 192-185-165-194.unifiedlayer.com
	Not shown: 979 closed ports
	PORT     STATE    SERVICE
	21/tcp   open     ftp
	22/tcp   filtered ssh
	25/tcp   open     smtp
	26/tcp   open     rsftp
	53/tcp   open     domain
	80/tcp   open     http
	| http-methods:
	|_  Supported Methods: OPTIONS GET HEAD POST
	110/tcp  open     pop3
	135/tcp  filtered msrpc
	139/tcp  filtered netbios-ssn
	143/tcp  open     imap
	443/tcp  open     https
	| http-methods:
	|_  Supported Methods: GET HEAD POST OPTIONS
	445/tcp  filtered microsoft-ds
	465/tcp  open     smtps
	587/tcp  open     submission
	593/tcp  filtered http-rpc-epmap
	993/tcp  open     imaps
	995/tcp  open     pop3s
	2222/tcp open     EtherNetIP-1
	3306/tcp open     mysql
	8080/tcp open     http-proxy
	| http-methods:
	|_  Supported Methods: OPTIONS GET HEAD POST
	8443/tcp open     https-alt
	| http-methods:
	|_  Supported Methods: GET HEAD POST OPTIONS
	
	Nmap done: 1 IP address (1 host up) scanned in 22.04 seconds
	root@kali:~#
	```
	- Find appropriate Metasploit module for the same

	```sh
	msf > use auxiliary/scanner/http/options
	msf auxiliary(options) > show options
	
	Module options (auxiliary/scanner/http/options):
	
	   Name     Current Setting  Required  Description
	   ----     ---------------  --------  -----------
	   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]
	   RHOSTS                    yes       The target address range or CIDR identifier
	   RPORT    80               yes       The target port (TCP)
	   SSL      false            no        Negotiate SSL/TLS for outgoing connections
	   THREADS  1                yes       The number of concurrent threads
	   VHOST                     no        HTTP server virtual host
	
	msf auxiliary(options) > set RHOSTS 172.217.0.78
	RHOSTS => 172.217.0.78
	msf auxiliary(options) > set THREADS 20
	THREADS => 20
	msf auxiliary(options) > run
	
	[*] 172.217.0.78 allows GET, HEAD methods
	[*] Scanned 1 of 1 hosts (100% complete)
	[*] Auxiliary module execution completed
	msf auxiliary(options) >
	```
	
	- Demo

	[![Demo for methods](https://i.ytimg.com/vi/pnoubdCNqco/hqdefault.jpg?sqp=-oaymwEXCNACELwBSFryq4qpAwkIARUAAIhCGAE=&rs=AOn4CLB5a-mHQBoD6rNelCjwgYnPZcvnzQ)](https://youtu.be/pnoubdCNqco)